<html>
  <head>
    <title>Admin Page</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link href="/styles/default-styles.css" type="text/css" rel="stylesheet" />
    <script>

      const platformHandler = (array) => {
          let platformReturn = `${array[0]}`;
          for (let i = 1; i < array.length; i++) {
            platformReturn += `, ${array[i]}`;
          }
          return platformReturn;
        }

      const handleResponse = (e) => {
          //console.log("e.target =", e.target); // here, `e.target` is the `xhr` object
          //console.log("e.target.response = ", e.target.response); // so that means this is a string of "joke" JSON
          const obj = JSON.parse(e.target.response); // turn it back into an object
          //console.log("obj=", obj);

          // const for dom elements
          const reviewsContainerDom = document.querySelector("#reviewsContainer");

              // clear the previous jokes so there is only ever 5
          reviewsContainerDom.innerHTML = ``;
          for (let i = 0; i < Object.keys(obj).length; i++) {
            reviewsContainerDom.innerHTML +=
               `<p>
                  <b>ID:</b> ${obj[i]}
                </p>
                <p>
                  <b>Game:</b> ${obj[i].game}
                </p>
                <p>
                  <b>Rating:</b> ${obj[i].rating}
                </p>
                <p>
                  <b>Platforms:</b> ${platformHandler(obj[i].platforms)}
                </p>
                <p>
                  <b>Review:</b> ${obj[i].content}
                </p>
            <hr>`;
          }
        };

      const downloadReview = (e) => {
          // remember that an `Event` object gets passed along every time that an event handler or listener calls a function
          // the `target` property of that event points at the element that sent the event, in this case a button

          let reviewURL = "/reviews?limit=10000";

          const xhr = new XMLHttpRequest();
          xhr.onload = handleResponse;
          xhr.open("GET", reviewURL);
          // with XHR, after we open a conncetion, but before we `send()`, we can set 1 or more HTTP request headers
          // this isn't strictly necessary becasue "/random-joke" sends JSON by default
          xhr.setRequestHeader('Accept', "application/javascript");
          xhr.send();
      };
    
      // const init = () => {
      //     // An Event *Handler*
      //     // document.querySelector("#btnJoke").onclick = downloadJoke; // same as below, less typing, use which ever version you prefer
    
      //     // An Event *Listener*
      //     document.querySelector("#btnReview").addEventListener("click", downloadReview);

    
      //     // **Actually, event handlers and listeners are NOT exactly the same in all use cases - what ARE the differences?**
      // };
    
    window.onload = downloadReview;
   
  </script>
  </head>
  <body class="container-fluid text-center">
    <header>
      <h1>What to Play?</h1>
        <nav class="nav nav-pills flex-column flex-sm-row">
            <a class="flex-sm-fill text-sm-center nav-link" href = "/">Home</span>
            <a class="flex-sm-fill text-sm-center nav-link" href = "app">Get a Review</a>
            <a class="flex-sm-fill text-sm-center nav-link" href = "submit">Submit</a>
            <a class="flex-sm-fill text-sm-center nav-link active" href="">Admin</a>
        </nav>
        <h2>Admin:<br>Here's all the Jokes on the Server</h2>
    </header>

    <div id="left" class="mx-auto" style="width: 600px;">
      <section>
        <div id="reviewsContainer">
          
        </div>
      </section>
    </div>
    <footer class="container-fluid text-center pt-2" id="footer">
      <p>&copy; Drew Donovan 2021</p>
    </footer>
  </body>
</html>
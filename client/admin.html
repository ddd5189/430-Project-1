<html>
  <head>
    <title>Admin Page</title>
    <link href="/styles/default-styles.css" type="text/css" rel="stylesheet" />
    <script>
      const handleResponse = (e) => {
          console.log("e.target =", e.target); // here, `e.target` is the `xhr` object
          console.log("e.target.response = ", e.target.response); // so that means this is a string of "joke" JSON
          const obj = JSON.parse(e.target.response); // turn it back into an object
          console.log("obj=", obj);

          // const for dom elements
          const reviewsContainerDom = document.querySelector("#reviewsContainer");

              // clear the previous jokes so there is only ever 5
        reviewsContainerDom.innerHTML = ``;
        for (let i = 0; i < Object.keys(obj).length; i++) {
          reviewsContainerDom.innerHTML +=
            `<p>
                <b>Game: ${obj[i].game}</b>
              </p>
              <p>
                <b><i>Rating: ${obj[i].rating}</i></b>
              </p>
              <p>
                <b>Platforms: ${obj[i].platforms}</b>
              </p>
              <p>
                <b>Review: ${obj[i].review}</b>
              </p>
          <hr>`;
        }
      };

      const downloadReview = (e) => {
          // remember that an `Event` object gets passed along every time that an event handler or listener calls a function
          // the `target` property of that event points at the element that sent the event, in this case a button
          console.log(`An element of id=${e.target.id} was clicked!`);

          let reviewURL = "/reviews?limit=10000";

          const xhr = new XMLHttpRequest();
          xhr.onload = handleResponse;
          xhr.open("GET", reviewURL);
          // with XHR, after we open a conncetion, but before we `send()`, we can set 1 or more HTTP request headers
          // this isn't strictly necessary becasue "/random-joke" sends JSON by default
          xhr.setRequestHeader('Accept', "application/javascript");
          xhr.send();
      };
    
      // const init = () => {
      //     // An Event *Handler*
      //     // document.querySelector("#btnJoke").onclick = downloadJoke; // same as below, less typing, use which ever version you prefer
    
      //     // An Event *Listener*
      //     document.querySelector("#btnReview").addEventListener("click", downloadReview);

    
      //     // **Actually, event handlers and listeners are NOT exactly the same in all use cases - what ARE the differences?**
      // };
    
    window.onload = downloadReview;
   
  </script>
  </head>
  <body>
    <header>
        <nav>
            <a href = "/">Home</span>
            <a href = "app">App</a>
            <a href = "submit">Submit</a>
            <span>Admin</span>
        </nav>

      <h1>This is the Admin Page</h1>
    </header>
    
    <section>
      <h2>Here's all the Jokes on the Server</h2>
      <div id="reviewsContainer">
        
      </div>
    </section>
    
    <!-- <section>
      <h2>How about 5 jokes?</h2>
      <p><button id="btnJokes">Show me 5 Jokes!</button></p>
      <div id="jokesContainer">
        
    </div>
    </section> -->
    
  </body>
</html>